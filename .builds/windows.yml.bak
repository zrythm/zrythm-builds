#
# Copyright (C) 2020 Alexandros Theodotou <alex at zrythm dot org>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.
#

image: archlinux
packages:
  - meson
  - chromaprint
  - python
  - gettext
  - sed
  - ninja
  - help2man
  - graphviz
  - zstd
  - tar
  - zip
  - unzip
  - rsync
  - lzip
  - ruby
  - gperf
  - intltool
  - p7zip
  - wget
  - vim
sources:
  - https://git.sr.ht/~alextee/zrythm
  - https://git.sr.ht/~alextee/zplugins
  - https://gitlab.gnome.org/GNOME/gtk
  - https://git.sr.ht/~alextee/mxe
  - https://git.sr.ht/~alextee/zrythm-installer
  - https://github.com/mesonbuild/meson
  - https://github.com/KDE/breeze-icons
secrets:
  - 063cb70d-6da6-492a-b530-04edc07651ba
  - 61caf4ff-56d5-4c2f-96da-63ef6adc241b
tasks:
  - make-windows: |
      # install wine
      sudo sh -c 'echo "[multilib]" >> /etc/pacman.conf'
      sudo sh -c 'echo "Include = /etc/pacman.d/mirrorlist" >> /etc/pacman.conf'
      sudo pacman -Syu --noconfirm
      sudo pacman -S --noconfirm wine
      wget https://www.zrythm.org/downloads/inno-setup-bin.zip
      # install inno
      unzip inno-setup-bin.zip -d ~/
      # create manuals zip
      zrythm-builds/scripts/create-manuals-zip.sh
      zrythm-builds/scripts/make-pkg.sh windows10
  - deploy-windows: |
      zrythm-builds/scripts/push-pkg.sh windows10
