image: archlinux
packages:
  - meson
  - gtk3
  - chromaprint
  - lilv
  - libx11
  - jack
  - breeze-icons
  - libsndfile
  - libyaml
  - libsamplerate
  - alsa-lib
  - fftw
  - suil
  - ffmpeg
  - python
  - gettext
  - gtksourceview4
  - sed
  - ninja
  - help2man
  - python-sphinx
  - ladspa
  - lv2
  - graphviz
  - rubberband
  - xdg-utils
  - lcov
  - gcovr
  - zstd
  - rtaudio
  - rtmidi
  - texlive-most
  - tar
  - zip
  - unzip
  - rsync
  - wget
sources:
  - https://git.sr.ht/~alextee/zrythm
  - https://git.sr.ht/~alextee/zrythm-installer
  - https://github.com/mesonbuild/meson
secrets:
  - 063cb70d-6da6-492a-b530-04edc07651ba
tasks:
  - make: |
      zrythm-builds/scripts/prepare.sh
      cd zrythm-installer
      make archlinux
  - deploy: |
      zrythm-builds/scripts/push-package.sh archlinux
      # deploy manuals
      . zrythm-builds/scripts/common.sh.in
      for lang in $LINGUAS ; do
        $RSYNC -rP \
          "zrythm-installer/build/zrythm-$ZRYTHM_PKG_VERSION/build/doc/user/$lang/latex/Zrythm.pdf" \
          "$REMOTE_IP:$REMOTE_HOME/manual/Zrythm-$ZRYTHM_PKG_VERSION-$lang.pdf"
      done
  - package-all: |
      timeout 1800 zrythm-builds/scripts/zip-gnu-linux-packages.sh
  - deploy-to-server: |
      echo "todo"
  - deploy-to-sendowl: |
      set -e
      . ~/.sendowl_credentials
